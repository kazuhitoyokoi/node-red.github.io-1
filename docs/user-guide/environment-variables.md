---
layout: docs-user-guide
toc: toc-user-guide.html
title: 環境変数を利用する
slug: 環境変数
---

### ノードのプロパティとして設定する

`${ENV_VAR}`という形式の文字列を値として設定することで、ノードのプロパティに環境変数を設定することができます。
ランタイムがフローを読み込んだとき、
ノードに文字列が渡される前に環境変数の値が代わりに使われます。

これはプロパティがまるごと置換できる場合のみ動作します - 値の一部だけに代入することはできません。
例えば、`CLIENT-${HOST}`を使うことは*できません*。

ノードはそれぞれの編集ダイアログを提供しているため、
全てのプロパティが環境変数の文字列を入力できるようなテキスト入力欄を提供しているわけではありません。
この場合、プロパティを設定するためにフローファイルを直に編集することを考えることができるかもしれません。


### TypedInputウィジェットとして利用する

<div style="width: 222px" class="figure align-right">
  <img src="editor/images/editor-typedInput-envvar-expanded.png" alt="TypedInput Environment Variable">
  <p class="caption">TypedInput環境変数型</p>
</div>


エディタ内で、TypedInputウィジェットは型として「環境変数」を提供することができます。
この型が選択されたとき、この値は以下のように評価されます。

 - `${}`が存在しない場合、値全体を環境変数名として利用します。
   例えば、
   `"FOO"`は`process.env.FOO`の値に置換されます。


 - `${}`が存在する場合、評価結果には対応する環境変数が代用されます:
   例えば、
   `"Hello ${FOO}"`という値で環境変数`FOO`に`World`が設定されている場合、
   この結果は`"Hello World"`という値になります。



### JSONata式

ChangeノードのようなノードからJSONana式の中で`$env`関数を利用することによって、
環境変数にアクセスすることができます。

```javascript
$env('ENV_VAR')
```

### Functionノード

Functionノード内で、
環境変数は`env.get`関数を利用することによってアクセスすることができます:

```javascript
let foo = env.get("FOO");
```

### Template node

*Since [Node-RED 3.0](https://nodered.org/blog/2022/07/14/version-3-0-released#environment-variables-in-the-template-node)*

The `template` node  can access environment variables using the syntax:
```
{% raw %}My favourite colour is {{env.COLOUR}}.{% endraw %}
```

### サブフローインスタンスプロパティ

0.20版以降、サブフローはインスタンスプロパティを設定できます。
これらは環境変数としてサブフロー内に表示され、
サブフローの個々のインスタンスにあわせてカスタマイズすることができます。

例えば、異なる種類のレコードへのアクセスを提供するREST APIがあり、
環境変数を利用してアクセスする必要があるレコードの種類を識別し、
サブフローはそのAPIにアクセスしてレスポンスを処理するように作成することができます。
そして、サブフローの個々のインスタンスをそれらの特定の種類にあわせてカスタマイズすることができます。



### Flow/Group level environment variables

*Since [Node-RED 2.1](https://nodered.org/blog/2021/10/21/version-2-1-released#flowgroup-level-environment-variables)*

Environment variables can be set at the flow or group level. This is done in the appropriate tab in the edit dialog for the flow or group.

### Accessing nested environment variables

When accessing an environment variable in a subflow, Node-RED will search the
subflow properties, then the flow containing the subflow (which could be a subflow
itself).

In some cases it is useful to access the 'parent' levels environment variables
without reference the 'local' value. This can be achieved by prefixing the
variable name with `$parent.`.


### Running as a service

When Node-RED is running as a service having been installed using the provided [script](https://nodered.org/docs/getting-started/raspberrypi), it will not have access to environment variables that are defined only in the calling process. In this instance, environment variables can be defined in the settings file by adding:

```
process.env.FOO='World';
```

placed outside the `module.exports` section. Alternatively, variables can be defined as part of the `systemd` service by placing statements of the form

```
ENV_VAR='foobar'
```
in a file named `environment` within the Node-RED user directory, `~/.node-red`.


### Built-In Environment Variables

*Since Node-RED 2.2*

Node-RED defines a set of environment variables for exposing information about the nodes, flows and groups.

This information helps "locate" the node in your [workspace](/docs/user-guide/editor/workspace). Nodes in your workspace exist as part of a [flow](/docs/user-guide/editor/workspace/flows). Likewise, a node may (or may not) be part of a [group](/docs/user-guide/editor/workspace/groups). Nodes, flows and groups are each given unique IDs that are generated by Node-RED.

Nodes, flows and groups all support the `name` property, which you can change when [editing properties](/docs/user-guide/editor/workspace/nodes#editing-node-properties).

The following environment variables can be used to access this information for a given node:

- `NR_NODE_ID` - the ID of the node
- `NR_NODE_NAME` - the Name of the node
- `NR_NODE_PATH` - the Path of the node. This represents a node's position in a flow.  It is `/` delimited IDs of the flow, enclosing subflows, and the node.
- `NR_GROUP_ID` - the ID of the containing group
- `NR_GROUP_NAME` - the Name of the containing group
- `NR_FLOW_ID` - the ID of the flow the node is on
- `NR_FLOW_NAME` - the Name of the flow the node is on

Note that while the IDs generated by Node-RED are guaranteed to be unique, the names are not. If a node, flow or group does not have a given name, the corresponding environment variable will be an empty string. If a node is not part of a group, its group id environment variable will also return an empty string.


